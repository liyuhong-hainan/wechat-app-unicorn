function mix(t,e,n){if(t[e]){var r=t[e];t[e]=function(){r.apply(this,arguments),n.apply(this,arguments)}}else t[e]=n}var _={};!function(){var t=Array.prototype,e=Object.prototype,n=t.slice,r=e.hasOwnProperty,i=t.forEach,o={};_.uuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},_.each=function(t,e,n){if(null!=t)if(i&&t.forEach===i)t.forEach(e,n);else if(t.length===+t.length){for(var s=0,a=t.length;s<a;s++)if(s in t&&e.call(n,t[s],s,t)===o)return}else for(var c in t)if(r.call(t,c)&&e.call(n,t[c],c,t)===o)return},_.extend=function(t){return _.each(n.call(arguments,1),function(e){for(var n in e)void 0!==e[n]&&(t[n]=e[n])}),t},_.isUndefined=function(t){return void 0===t},_.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},_.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},_.isFunction=function(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}},_.isObject=function(t){return t===Object(t)&&!_.isArray(t)},_.getSystemInfo=function(){var t=wx.getSystemInfoSync();return t.resolution=t.windowWidth+"x"+t.windowHeight,t},_.encode=function(t){var e={};for(var n in t)e["_"+n]=t[n];return e},_.getNet=function(t){wx.getNetworkType({complete:function(e){var n="wifi"===e.networkType?1:0,r={"2g":1,"3g":3,"4g":13},i="wifi"===e.networkType?0:r[e.networkType];storage.set("net",n),storage.set("mnet",i),t&&t({net:n,mnet:i})}})}}();var storage={key:"zg"};storage.get=function(t){var e=this.getAll();return e?e[t]:null},storage.set=function(t,e){var n=this.getAll();n[t]=e,wx.setStorageSync(this.key,n)},storage.del=function(t){var e=this.getAll();delete e[t],wx.setStorageSync(this.key,e)},storage.getAll=function(){var t=wx.getStorageSync(this.key);return t||(t={cache:[],ec:0,net:0,mnet:0},wx.setStorageSync(this.key,t)),t},storage.clear=function(){wx.removeStorageSync(this.key)},storage.getDid=function(){return wx.getStorageSync("zg-did")},storage.registerDid=function(){wx.setStorageSync("zg-did",_.uuid())},storage.flush=function(){for(var t=this.get("sid"),e=this.get("cache"),n=0,r=e.length;n<r;n++){var i=e[n];i.hasOwnProperty("sid")&&(i.sid=t)}return this.set("cache",[]),e};var ZGTracker=function(){this._props={appKey:"",br:"wx-app",an:"",vn:""},this._url={normal:"https://u.zhugeapi.com/web_event",bac:"https://ubak.zhugeio.com/web_event"},this._config={debug:!1,an:"wxApp",vn:"1.0"},this._sdk="web",this._sdkv="2.0"};ZGTracker.prototype._registerOnce=function(){storage.getDid()||storage.registerDid()},ZGTracker.prototype._sendRequest=function(t){var e=new Date,n={method:"web_event_srv.upload",event:{sln:"itn",pl:"js",sdk:"zg-js",sdkv:this._sdkv,owner:"zg",ut:[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")+" "+e.toTimeString().match(/\d{2}:\d{2}:\d{2}/)[0],tz:6e4*-e.getTimezoneOffset(),debug:this._config.debug?1:0,ak:this._props.appKey,usr:{did:storage.getDid()},data:[]},_:(new Date).getTime().toString()},r=storage.get("cache");storage.get("sid")?(r.length&&n.event.data.push(storage.flush()),n.event.data.push(t),this._request(n)):(r.push(t),storage.set("cache",r))},ZGTracker.prototype._request=function(t){var e=this;wx.request({url:this._url.normal,data:t,fail:function(){wx.request({url:e._url.bac,data:t})}})},ZGTracker.prototype._info=function(){var t=_.getSystemInfo(),e=new Date,n={dt:"pl",pr:{$rs:t.resolution,$tz:6e4*-e.getTimezoneOffset(),$ct:e.getTime(),$cuid:storage.get("cuid")}};this._sendRequest(n)},ZGTracker.prototype._sessionStart=function(){var t=new Date,e=t.getTime(),n=_.getSystemInfo(),r=this;storage.set("sid",e),_.getNet(function(i){var o={dt:"ss",pr:{$ct:t.getTime(),$sid:e,$cuid:storage.get("cuid"),$tz:6e4*-t.getTimezoneOffset(),$url:storage.get("$url"),$os:n.system.split(/\s/)[0],$ov:n.system.split(/\s/)[1],$wv:n.version,$mnet:i.mnet,$net:i.net,$vn:r._props.vn}};o.pr=_.extend(o.pr,storage.get("utm")),r._sendRequest(o)})},ZGTracker.prototype._sessionEnd=function(){var t=storage.get("sid"),e=new Date,n=e.getTime()-t,r={dt:"se",pr:{$ct:e.getTime(),$tz:6e4*-e.getTimezoneOffset(),$dru:n,$sid:t,$cuid:storage.get("cuid")}};this._sendRequest(r),storage.clear()},ZGTracker.prototype._init=function(){this._registerOnce(),this._sessionStart(),this._info()},ZGTracker.prototype.load=function(t,e){this._props.appKey=t,storage.set("appKey",t),_.isObject(e)&&(this._config=_.extend(this._config,e),this._config.an&&(this._props.an=this._config.an),this._config.vn&&(this._props.vn=this._config.vn))},ZGTracker.prototype.identify=function(t,e){var n=storage.get("sid"),r=new Date;storage.set("cuid",t);var i={dt:"usr",pr:{$ct:r.getTime(),$tz:6e4*-r.getTimezoneOffset(),$cuid:t,$sid:n,$url:storage.get("$url")}};_.isObject(e)&&(i.pr=_.extend(i.pr,_.encode(e))),this._sendRequest(i)},ZGTracker.prototype.track=function(t,e){var n=storage.get("sid"),r=new Date,i=_.getSystemInfo(),o=this;storage.set("ec",storage.get("ec")+1),_.getNet(function(s){var a={dt:"evt",pr:{$eid:t,$ct:r.getTime(),$tz:6e4*-r.getTimezoneOffset(),$cuid:storage.get("cuid"),$sid:n,$url:storage.get("$url"),$os:i.system.split(/\s/)[0],$ov:i.system.split(/\s/)[1],$wv:i.version,$mnet:s.mnet+"",$net:s.net+"",$vn:o._props.vn}};_.isObject(e)&&(a.pr=_.extend(a.pr,_.encode(e))),o._sendRequest(a)})},ZGTracker.prototype.start=function(){this._init()},ZGTracker.prototype.end=function(){this._sessionEnd()};var zhuge=new ZGTracker,appLaunch=function(){},appShow=function(){zhuge.start()},appHide=function(){zhuge.end()},a=App;App=function(t){mix(t,"onLaunch",appLaunch),mix(t,"onShow",appShow),mix(t,"onHide",appHide),a(t)};var pageLoad=function(t){var e=t||{},n=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],r={};n.forEach(function(t){e[t]&&(r["$"+t]=e[t])}),storage.set("utm",r)},pageShow=function(){storage.set("$url",this.__route__)},pageHide=function(){},p=Page;Page=function(t){mix(t,"onLoad",pageLoad),mix(t,"onShow",pageShow),mix(t,"onHide",pageHide),p(t)},App.zhuge=zhuge,module.exports=new ZGTracker;